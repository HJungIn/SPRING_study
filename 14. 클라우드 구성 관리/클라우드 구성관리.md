#  ν΄λΌμ°λ“ κµ¬μ„±κ΄€λ¦¬
* μ¤ν”„λ§ λ¶€νΈ μ• ν”λ¦¬μΌ€μ΄μ…μ κµ¬μ„± μ†μ„±μ€ application.yml νμΌμ— κµ¬μ„± μ†μ„±μ„ μ§€μ •ν•λ©΄ λ¨.
* ν•μ§€λ§ λ§μ΄ν¬λ΅μ„λΉ„μ¤λ΅ μ• ν”λ¦¬μΌ€μ΄μ…μ„ κµ¬μ¶•ν•  λ•λ” μ—¬λ¬ λ§μ΄ν¬λ΅μ„λΉ„μ¤μ— κ±Έμ³ λ™μΌν• κµ¬μ„± μ†μ„±μ΄ μ μ©λλ―€λ΅ λ¬Έμ κ°€ λ  μ μλ‹¤.
* μ¤ν”„λ§ ν΄λΌμ°λ“μ κµ¬μ„± μ„λ²„(Config Server) : μ• ν”λ¦¬μΌ€μ΄μ…μ λ¨λ“  λ§μ΄ν¬λ΅μ„λΉ„μ¤μ— λ€ν•΄ μ¤‘μ•™ μ§‘μ¤‘μ‹μ κµ¬μ„±μ„ μ κ³µν•¨. => λ”°λΌμ„ <u>κµ¬μ„± μ„λ²„λ¥Ό μ‚¬μ©ν•λ©΄ μ• ν”λ¦¬μΌ€μ΄μ…μ λ¨λ“  κµ¬μ„±μ„ ν• κ³³μ—μ„ κ΄€λ¦¬ν•  μ μμ.</u>

* κµ¬μ„± μ„λ²„ : application.ymlμ΄ μλ” 1λ€μ μ„λ²„
* ν΄λΌμ΄μ–ΈνΈ : κµ¬μ„±μ„λ²„λ¥Ό μ‚¬μ©ν•λ” κ°λ³„ μ„λ²„

<br><br>
---

###  κµ¬μ„± κ³µμ ν•κΈ°
* κ°„λ‹¨ν• μ• ν”λ¦¬μΌ€μ΄μ…μ κ²½μ° : κµ¬μ„± μ†μ„±μ΄ λ°νƒ€μ„ ν™κ²½μ„ λ³€κ²½ν•κ±°λ‚ λ°νƒ€μ„ ν™κ²½μ— κ³ μ ν• κ²ƒμ΄μ–΄μ•Ό ν•λ‹¤λ©΄, <u>μλ°” μ‹μ¤ν… μ†μ„±μ΄λ‚ μ΄μμ²΄μ μ ν™κ²½ λ³€μ</u>λ¥Ό κµ¬μ„± μ†μ„±μΌλ΅ μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ‹μ. κ·Έ μ™Έμ— κ°’μ΄ λ³€κ²½λ  κ°€λ¥μ„±μ΄ κ±°μ μ—†κ³  μ• ν”λ¦¬μΌ€μ΄μ…μ— νΉμ •λλ” μ†μ„±μ κ²½μ°λ” application.ymlμ΄λ‚ application.properties μ‚¬μ©ν•κΈ°. 
<br>=> λ‹¨μ  : ν•΄λ‹Ή μ†μ„±μ λ³€κ²½μΌλ΅ μΈν•΄ μ¬μ‹μ‘ν•μ—¬ λ‹¤μ‹ λΉλ“ ν›„ λ°°ν¬ν•΄μ•Ό ν•λ‹¤.

* μ¤‘μ•™ μ§‘μ¤‘μ‹ κµ¬μ„±μΌλ΅ κ΄€λ¦¬ μ‹
    * κµ¬μ„±μ΄ μ• ν”λ¦¬μΌ€μ΄μ… μ½”λ“μ— ν¨ν‚¤μ§•λμ–΄ ν¨ν¬λμ§€ μ•μ. => λ”°λΌμ„, μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ‹¤μ‹ λΉλ“ν•κ±°λ‚ λ°°ν¬ν•μ§€ μ•κ³  κµ¬μ„±μ„ λ³€κ²½ν•κ±°λ‚ μ›λ κ°’μΌλ΅ ν™μ›ν•  μ μλ‹¤. κ·Έλ¦¬κ³  μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ‹¤μ‹ μ‹μ‘ν•κΈ° μ•μ•„λ„ μ‹¤ν–‰ μ¤‘μ— κµ¬μ„±μ„ λ³€κ²½ν•  μ μλ‹¤.
    * κ³µν†µμ μΈ κµ¬μ„±μ„ κ³µμ ν•λ” λ§μ΄ν¬λ΅μ„λΉ„μ¤κ°€ μμ‹ μ μ†μ„± μ„¤μ •μΌλ΅ μ μ§€&κ΄€λ¦¬ν•μ§€ μ•κ³ λ„ λ™μΌν• μ†μ„±λ“¤μ„ κ³µμ ν•  μ μλ‹¤. => μ†μ„± λ³€κ²½ ν•„μ” μ‹ ν• κ³³μ—μ„ ν•λ²λ§ λ³€κ²½ν•΄λ„ λ¨λ“  λ§μ΄ν¬λ΅ μ„λΉ„μ¤μ— μ μ©ν•  μ μμ
    * λ³΄μ•μ— λ―Όκ°ν• κµ¬μ„± μ†μ„±μ€ μ• ν”λ¦¬μΌ€μ΄μ… μ½”λ“μ™€λ” λ³„λ„λ΅ μ•”νΈν™”ν•κ³  μ μ§€&κ΄€λ¦¬ν•  μ μμ. κ·Έλ¦¬κ³  λ³µνΈν™”λ μ†μ„± κ°’μ„ μ–Έμ λ“ μ§€ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ‚¬μ©ν•  μ μμΌλ―€λ΅ λ³µνΈν™”λ¥Ό ν•λ” μ½”λ“κ°€ μ• ν”λ¦¬μΌ€μ΄μ…μ— μ—†μ–΄λ„ λ¨

* μ¤ν”„λ§ ν΄λΌμ°λ“ κµ¬μ„± μ„λ²„λ” μ• ν”λ¦¬μΌ€μ΄μ…μ λ¨λ“  λ§μ΄ν¬λ΅ μ„λΉ„μ¤κ°€ κµ¬μ„±μ— μμ΅΄ν•  μ μλ” μ„λ²„λ¥Ό μ‚¬μ©ν•΄μ„ μ¤‘μ•™ μ§‘μ¤‘μ‹ κµ¬μ„±μ„ μ κ³µν•λ‹¤.<br>
=> <u>λ”°λΌμ„ λ¨λ“  μ„λΉ„μ¤μ— κ³µν†µλ κµ¬μ„±μ€ λ¬Όλ΅ μ΄κ³ , νΉμ • μ„λΉ„μ¤μ— κµ­ν•λ κµ¬μ„±λ„ ν• κ³³μ—μ„ κ΄€λ¦¬ν•  μ μλ‹¤.</u> 

<br><br>
---

### κµ¬μ„± μ„λ²„ μ‹¤ν–‰ν•κΈ°
* μ¤ν”„λ§ ν΄λΌμ°λ“ κµ¬μ„± μ„λ²„ : μ§‘μ¤‘ν™”λ κµ¬μ„± λ°μ΄ν„° μ†μ¤λ¥Ό μ κ³µν•¨
    * μ λ μΉ΄μ²λΌ λ” ν° μ• ν”λ¦¬μΌ€μ΄μ…μ λ§μ΄ν¬λ΅μ„λΉ„μ¤λ΅, <u>κ°™μ€ μ• ν”λ¦¬μΌ€μ΄μ…μ— μλ” λ‹¤λ¥Έ μ„λΉ„μ¤λ“¤μ κµ¬μ„± λ°μ΄ν„°λ¥Ό μ κ³µ</u>ν•λ” μ—­ν• 
        * κµ¬μ„± μ„λ²„λ¥Ό ν†µν—¤ μ κ³µλλ” κµ¬μ„± λ°μ΄ν„°λ” κµ¬μ„± μ„λ²„μ μ™Έλ¶€(Git)μ— μ €μ¥λ¨.<br/>
        => Git(μ†μ¤ μ½”λ“ μ μ–΄ μ‹μ¤ν…)μ— κµ¬μ„± μ†μ„±μ„ μ €μ¥ν•¨μΌλ΅μ¨ μ• ν”λ¦¬μΌ€μ΄μ… μ†μ¤ μ½”λ“μ²λΌ κµ¬μ„± μ†μ„±μ λ²„μ „, λ¶„κΈ° λ“±μ„ κ΄€λ¦¬ν•  μ μλ‹¤.<br/>
        => But, κµ¬μ„± μ†μ„±μ„ μ‚¬μ©ν•λ” μ• ν”λ¦¬μΌ€μ΄μ…κ³Ό λ³„λ„λ΅ κµ¬μ„± μ†μ„±μ„ μ μ§€&κ΄€λ¦¬ν•λ―€λ΅ <u>μ• ν”λ¦¬μΌ€μ΄μ…κ³Ό λ…λ¦½μ μΌλ΅ λ²„μ „μ„ κ΄€λ¦¬</u>ν•  μ μμ.
    * ν΄λΌμ΄μ–ΈνΈκ°€ λλ” <u>λ‹¤λ¥Έ μ„λΉ„μ¤λ“¤μ΄ κµ¬μ„± μ†μ„±μ„ μ‚¬μ©ν•  μ μλ„λ΅ REST API μ κ³µ</u>

* μ¤ν”„λ§ ν΄λΌμ°λ“ κµ¬μ„± μ„λ²„λ” Git μ΄λ‚ Vault(λ³ΌνΈ)λ¥Ό λ°±μ—”λ“λ΅ μ‚¬μ©ν•΄μ„ κµ¬μ„± μ†μ„±μ„ μ κ³µν•¨.
    ![alt text](image.png)
    * Vault(from ν•΄μ‹μ½”ν”„) : λ³΄μ• μ²λ¦¬λ κµ¬μ„± μ†μ„±μ„ μ μ§€&κ΄€λ¦¬ν•  λ• νΉν μ μ©ν•¨

##### κµ¬μ„± μ„λ²„ ν™μ„±ν™”ν•κΈ°
* κµ¬μ„± μ„λ²„λ” λ³„κ°μ μ• ν”λ¦¬μΌ€μ΄μ…μΌλ΅ κ°λ°λμ–΄ λ°°ν¬λλ‹¤.
* μ„¤μ • λ°©λ²•
    1. μμ΅΄μ„± μ¶”κ°€
        ```gradle
        plugins {
            id 'java'
            id 'org.springframework.boot' version '3.0.13'
            id 'io.spring.dependency-management' version '1.1.6'
        }
        ...
        ext {
        //    set('springCloudVersion', "2023.0.3")
            set('springCloudVersion', "Hoxton.SR3")
        }

        dependencies {
            implementation 'org.springframework.cloud:spring-cloud-config-server'
            testImplementation 'org.springframework.boot:spring-boot-starter-test'
            testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
        }

        dependencyManagement {
            imports {
                mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
            }
        }
        ...
        ```

    2. ν™μ„±ν™” μ• λ…Έν…μ΄μ… μ¶”κ°€ : <code>@EnableConfigServer</code>
        ```java
        @SpringBootApplication
        @EnableConfigServer
        public class ConfigServerApplication {
            ...
        }
        ```

    3. κµ¬μ„± μ†μ„±λ“¤μ΄ μλ”κ³³(κµ¬μ„± λ¦¬νΌμ§€ν„°λ¦¬)μ„ μ•λ ¤μ£ΌκΈ°
        * 2κ° λ‹¤ μ„¤μ •ν•΄ λ†“μ•„μ•Όν•¨
        * githubμ κ²½μ° : μ¤‘μ•™ μ €μ¥μ†μ κ²½μ°
        ```yml
        # githubμ κ²½μ°(μ¤‘μ•™ μ €μ¥μ†)
        spring:
            cloud:
                config:
                    server:
                        git:
                            uri: https://github.com/habuma/tacocloud-config.git

        server:
        port: 8888 # κµ¬μ„± μ„λ²„μ ν΄λΌμ΄μ–ΈνΈκ°€ κµ¬μ„± μ„λ²„λ΅λ¶€ν„° κµ¬μ„± λ°μ΄ν„°λ¥Ό κ°€μ Έμ¬ λ• μ‚¬μ©ν•λ” κΈ°λ³Έ ν¬νΈ λ²νΈ
        # κµ¬μ„± μ„λ²„μ ν΄λΌμ΄μ–ΈνΈ μ„λΉ„μ¤μ—μ„λ„ κ°™μ€ λ²νΈ μ‚¬μ©ν•΄μ•Όν•¨
        # κµ¬μ„± μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ— μ κ³µν•λ” κµ¬μ„± μ†μ„±μ€ Gitμ΄λ‚ Vaultμ λ¦¬νΌμ§€ν„°λ¦¬μ—μ„ κ°€μ Έμ΄
        ```

        * <b>Git ν•μ„ κ²½λ΅λ΅ κµ¬μ„± μ†μ„± μ €μ¥ν•κΈ°</b>
        ```yml
        spring:
            cloud:
                config:
                    server:
                        git:
                            uri: http://localhost:10080/tacocloud/tacocloud-config
                            search-paths: config # configλΌλ” μ„λΈ λ””λ ‰ν† λ¦¬μ— κµ¬μ„± μ†μ„±μ„ μ €μ¥ν•  λ•

                            # search-paths: config, moreConfig # λ³µμ κ°€λ¥
                            # search-paths: config, more* # μ™€μΌλ“ μΉ΄λ“ μ‚¬μ© κ°€λ¥
        ```

        * <b>Git λ¦¬ν¬μ§€ν† λ¦¬μ λ¶„κΈ°λ‚ λΌλ²¨μ— κµ¬μ„± μ†μ„± μ €μ¥ν•κ³  μ κ³µν•κΈ°</b>
        ```yml
        # κΈ°λ³Έμ μΌλ΅λ” master λ¶„κΈ°μ—μ„ κµ¬μ„± μ†μ„±μ„ κ°€μ Έμ΄
        spring:
            cloud:
                config:
                    server:
                        git:
                            uri: http://localhost:10080/tacocloud/tacocloud-config
                            default-label: sidework # sideworkλ΅ κΈ°λ³Έ λΌλ²¨μ΄λ‚ λ¶„κΈ°κ°€ λ³€κ²½λ¨

        ```

        * <b>Git λ°±μ—”λ“λ¥Ό μ‚¬μ©ν• μΈμ¦</b>
        ```yml
        # κµ¬μ„± μ„λ²„κ°€ μ½λ” λ°±μ—”λ“ Git λ¦¬ν¬μ§€ν† λ¦¬λ” μ‚¬μ©μ μ΄λ¦„κ³Ό λΉ„λ°€λ²νΈλ΅ μΈμ¦λ  μ μμ.
        spring:
            cloud:
                config:
                    server:
                        git:
                            uri: http://localhost:10080/tacocloud/tacocloud-config
                            username: username
                            password: 123456

        ```

    4. κµ¬μ„± μ„λ²„ μ‹¤ν–‰ ν›„ ν…μ¤νΈ
    * κµ¬μ„± μ„λ²„λ” REST APIλ¥Ό ν†µν•΄μ„ κµ¬μ„± μ†μ„±μ„ μ κ³µν•λ‹¤.
    * κµ¬μ„± μ„λ²„μ ν΄λΌμ΄μ΄μ–ΈνΈκ°€ μ‘μ„±λμ§€ μ•μ•μ„ λ• ν…μ¤νΈ λ°©λ²•
    * <code>curl localhost:8888/application/default</code>
        1. localhost:8888 : κµ¬μ„± μ„λ²„μ νΈμ¤νΈ μ΄λ¦„κ³Ό ν¬νΈ
        2. application : μ• ν”λ¦¬μΌ€μ΄μ… μ΄λ¦„(spring.application.name)
        3. default : ν™μ„±ν™”λ μ¤ν”„λ§ ν”„λ΅νμΌ
        4. master : Git λΌλ²¨/λ¶„κΈ° (μƒλµ κ°€λ¥)
    * κ²°κ³Ό
        ```json
        C:\Users\hji>curl localhost:8888/application/default
        {
         "name":"application",
         "profiles":["default"],
         "label":null,
         "version":"551620858a658c9f2696c7f543f1d7effbadaef4",
         "state":null,
         "propertySources":[{
                "name":"https://github.com/habuma/tacocloud-config.git/application.yml",
                "source":{
                    "server.port":0,
                    "eureka.client.service-url.defaultZone":"http://localhost:8761/eureka/",
                    "invalid.spring.data.mongodb.password":"<n/a>"
                    }
            }]
         }
        ```

##### Git λ¦¬νΌμ§€ν„°λ¦¬μ— κµ¬μ„± μ†μ„± μ €μ¥ν•κΈ° (κµ¬μ„± μ„λ²„ x, ν΄λΌμ΄μ–ΈνΈ μ„λ²„ o)
* κµ¬μ„± μ„λ²„κ°€ κ°€μ Έμ¬ μ†μ„±μ„ μ¤€λΉ„ν•λ” λ°©λ²• : Git λ¦¬ν¬μ§€ν† λ¦¬μ λ£¨νΈ κ²½λ΅λ΅ application.properties λ‚ application.yml νμΌμ„ μ»¤λ°‹ν•λ” κ²ƒ
* μμ‹ yml
```yml
server:
    port: 0 # λ¬΄μ‘μ„ ν¬νΈ μ‚¬μ©

eureka:
    client:
        service-url:
            defaultZone: http://eureka1:8761/eureka/
```


<br><br>
---

### κ³µμ λλ” κµ¬μ„± λ°μ΄ν„° μ‚¬μ©ν•κΈ°
* μ¤ν”„λ§ ν΄λΌμ°λ“ κµ¬μ„± μ„λ²„λ” <u>μ¤‘μ•™ μ§‘μ¤‘μ‹ κµ¬μ„± μ„λ²„λ¥Ό μ κ³µ</u>ν•λ©°, <u>ν΄λΌμ΄μ–ΈνΈ λΌμ΄λΈλ¬λ¦¬λ„ μ κ³µ</u>ν•λ‹¤.

1. μμ΅΄μ„± μ¶”κ°€
    ```gradle
    implementation 'org.springframework.cloud:spring-cloud-starter-config'
    ```
2. μ†μ„± μ„¤μ •
    ```yml
    # κµ¬μ„± μ„λ²„μ μ„μΉ
    # => λ³΄ν†µ μ΄ μ†μ„±μ„ ν΄λΌμ΄μ–ΈνΈκ°€ λλ” μ• ν”λ¦¬μΌ€μ΄μ… μμ²΄ λ‚΄λ¶€ application.ymlμ— μ„¤μ •λμ–΄μ•Ό ν•¨
    # => ν•μ§€λ§ μ¤‘μ•™ μ§‘μ¤‘μ‹ κµ¬μ„± μ„λ²„κ°€ μμ„ λ•λ” "κµ¬μ„± μ„λ²„"κ°€ μ κ³µν•κΈ° λ•λ¬Έμ— κ° λ§μ΄ν¬λ΅ μ„λΉ„μ¤κ°€ μμ‹ μ κµ¬μ„±μ„ κ°€μ§ ν•„μ”κ°€ μ—†μΌλ©°, spring.cloud.config.uri(κµ¬μ„±μ„λ²„μ μ„μΉ)μ™€ spring.application.name(κµ¬μ„± μ„λ²„μ— μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ•λ ¤μ£Όλ”) μ†μ„±λ§ κ° λ§μ΄ν¬λ΅ μ„λΉ„μ¤μ— μ„¤μ •ν•λ©΄ λ¨.
    spring:
        cloud:
            config:
                uri: http://config.tacocloud.com:8888
    ```
    * μμ„ : μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ -> κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈκ°€ κµ¬μ„± μ„λ²„μ— μ†μ„±κ°’ μ”μ²­ -> λ°›μ€ ν›„ κ° μ• ν”λ¦¬μΌ€μ΄μ…μ ν™κ²½μ—μ„ μ΄ μ†μ„±λ“¤μ„ μ‚¬μ©ν•  μ o
    * κ²λ‹¤κ°€ μ΄ μ†μ„±λ“¤μ€ ν¨κ³Όμ μΌλ΅ μΊμ‹±λλ―€λ΅ κµ¬μ„± μ„λ²„μ μ‹¤ν–‰μ΄ μ¤‘λ‹¨λλ”λΌλ„ μ‚¬μ©ν•  μ μλ‹¤.

<br><br>
---

### μ• ν”λ¦¬μΌ€μ΄μ…μ΄λ‚ ν”„λ΅νμΌμ— νΉμ •λ μ†μ„± μ κ³µν•κΈ°
* κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈ μ‹μ‘ : μ• ν”λ¦¬μΌ€μ΄μ…μ μ΄λ¦„ + ν™μ„± ν”„λ΅νμΌλ΅ μ”μ²­
    * <u>μ• ν”λ¦¬μΌ€μ΄μ…μ μ΄λ¦„ μ„¤μ •</u> : <code>spring.application.name</code>
    * <u>ν™μ„± ν”„λ΅νμΌ μ„¤μ •</u> : <code>spring.profiles.active</code> 

##### μ• ν”λ¦¬μΌ€μ΄μ…μ— νΉμ •λ μ†μ„± μ κ³µν•κΈ°
* κµ¬μ„± μ„λ²„ : νΉμ • μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ€μƒμΌλ΅ ν•λ” κµ¬μ„± μ†μ„±μ„ κ΄€λ¦¬ν•  μ μμ.
    * => λ¨λ“  λ§μ΄ν¬λ΅μ„λΉ„μ¤κ°€ κ³µμ ν•  ν•„μ” μ—†λ” μ†μ„±λ“¤μ΄ μμ„ λ•κ°€ μμ.

1. <code>spring.application.name</code>μ„ μ‚¬μ©ν• λ§μ΄ν¬λ΅ μ„λΉ„μ¤μ μ΄λ¦„ μ§€μ •
2. κµ¬μ„± μ„λ²„μ Git λ°±μ—”λ“μ— ingredient-service.yml , order-service.yml , taco-service.yml , user-service.yml λΌλ” 1λ²μ—μ„ μ„¤μ •ν• μ΄λ¦„μ yml κµ¬μ„± νμΌλ“¤μ„ μƒμ„±ν•λ©΄ λ¨.
![alt text](image-1.png)
    * μ°μ„  μμ„ : νΉμ •ν• κµ¬μ„± νμΌμ μ†μ„±(order-service.yml) > κ³µν†µ μ†μ„±(application.yml)

##### ν”„λ΅νμΌλ΅λ¶€ν„° μ†μ„± μ κ³µν•κΈ°
* ν”„λ΅νμΌμ— νΉμ •λ μ†μ„±λ“¤μ„ μ§€μ›ν•¨

* <μ—¬λ¬κ°μ ymlλ΅ μ—¬λ¬κ°μ ν”„λ΅νμΌ κµ¬μ„±ν•κΈ°>
    1. application-production.yml ν•μ‹μ μ΄λ¦„μΌλ΅ κµ¬μ„± νμΌμ„ λ…λ…

* <ν•λ‚μ yml νμΌ λ‚΄λ¶€μ— μ—¬λ¬κ°μ ν”„λ΅νμΌ κµ¬μ„± κ·Έλ£Ήμ„ ν¬ν•¨ν•λ” λ°©λ²•>
    1. 3κ°μ ν•μ΄ν”(---) + spring.profiles μ†μ„± μ§€μ •
        ```yml
        spring.profiles: dev # μ΄λ¦„ λ…λ…
        spring.profiles.include: devdb,devmq
        ---
        spring.profiles: prod # μ΄λ¦„ λ…λ…
        spring.profiles.include: proddb,prodmq
        ```

![alt text](image-2.png)
![alt text](image-3.png)

* ν”„λ΅νμΌ ν™μ„±ν™”
    ```yml
    spring:
        profiles:
            active: dev
    ```

<br><br>
---

### κµ¬μ„± μ†μ„±λ“¤μ λ³΄μ• μ μ§€ν•κΈ°
* λ³΄μ• κµ¬μ„± μ†μ„± μ‚¬μ© μ‹ κµ¬μ„± μ„λ²„κ°€ μ κ³µν•λ” 2κ°€μ§€ μµμ…
    * Git λ°±μ—”λ“ λ¦¬ν¬μ§€ν† λ¦¬μ— μ €μ¥λ κµ¬μ„± νμΌμ— μ•”νΈν™”λ κ°’ μ“°κΈ°
    * Git λ°±μ—”λ“ λ¦¬ν¬μ§€ν† λ¦¬μ— μ¶”κ°€(λλ” λ€μ‹ )ν•μ—¬ κµ¬μ„± μ„λ²„μ λ°±μ—”λ“ μ €μ¥μ†λ΅ ν•΄μ‹μ½”ν”„μ Vault μ‚¬μ©ν•κΈ°

##### Git λ°±μ—”λ“μ μ†μ„±λ“¤ μ•”νΈν™”ν•κΈ°
* κµ¬μ„± μ„λ²„λ” Git λ¦¬ν¬μ§€ν† λ¦¬μ— μ €μ¥λ κµ¬μ„± νμΌμ— μ“°λ” μ•”νΈν™”λ κ°’λ“¤λ„ μ κ³µν•  μ μμ.<br/>
=> ν•µμ‹¬ : <b><u>μ•”νΈν™” ν‚¤</u></b>
    * μ•”νΈν™” ν‚¤λ¥Ό μ‚¬μ©ν•΄μ„ κµ¬μ„± μ„λ²„λ¥Ό κµ¬μ„±ν•΄μ•Ό ν•¨.
    * λ€μΉ­ ν‚¤, λΉ„λ€μΉ­ ν‚¤ λ¨λ‘ μ§€μ›ν•¨.
    * <λ€μΉ­ ν‚¤ μ„¤μ •>
        1. κµ¬μ„± μ„λ²„ μμ²΄ κµ¬μ„±μ <code>encrypt.key</code>μ— ν‚¤ μ„¤μ •
            ```yml
            # bootstrap.ymlμ— μ„¤μ •λμ–΄μ•Ό ν•¨. => why? κ·Έλμ•Ό μλ™-κµ¬μ„±μ΄ κµ¬μ„± μ„λ²„λ¥Ό ν™μ„±ν™”μ‹ν‚¤κΈ° μ „μ— λ΅λ“λμ–΄ μ‚¬μ©ν•  μ μκΈ° λ•λ¬Έμ—
            encrypt:
                key: s3cr3t
            ```
    * <λΉ„λ€μΉ­ ν‚¤ μ„¤μ •> : λ” κ°•λ ¥ν• λ³΄μ•μΌλ΅, κµ¬μ„± μ„λ²„κ°€ ν• μμ λΉ„λ€μΉ­ RSA ν‚¤λ‚ ν‚¤μ¤ν† μ–΄μ μ°Έμ΅°λ¥Ό μ‚¬μ©ν•λ„λ΅ κµ¬μ„±ν•  μ μμ.
        1. keytool λ…λ Ήν–‰ λ„κµ¬λ¥Ό μ‚¬μ©ν•΄ ν‚¤λ¥Ό μƒμ„±ν•¨.
            ```
            keytool -genkeypair -alias tacokey -ketalg RSA \
            -dname "CN=Web Server,OU=Unit,O=Organization,L=City,S=State,C=US" \
            -keypass s3cr3t -keystore keystore.jks -storepass l3tm31n
            ```
            * κ²°κ³Όλ΅ μƒμ„±λλ” ν‚¤μ¤ν† μ–΄λ” keystore.jksλΌλ” μ΄λ¦„μΌλ΅ μ €μ¥λλ©°, νμΌ μ‹μ¤ν…μ ν‚¤μ¤ν† μ–΄ νμΌλ΅ μ μ§€ν•κ±°λ‚ μ• ν”λ¦¬μΌ€μ΄μ… μμ²΄μ— λ‘ μ μμ.
        2. ν•΄λ‹Ή ν‚¤μ¤ν† μ–΄ μ„μΉμ™€ μΈμ¦ μ •λ³΄λ¥Ό <u>κµ¬μ„± μ„λ²„μ bootstrap.yml νμΌ</u>μ— κµ¬μ„±ν•¨. - 1λ²μ ν•΄λ‹Ή ν‚¤μ¤ν† μ–΄λ¥Ό μ‚¬μ©ν•  μ μλ„λ΅ ν•κΈ° μ„ν•΄ 
            ```yml
            encrypt:
                key-store:
                    alias: tacokey
                    location: classpath:/keystore.jks
                    password: l3tm31n
                    secret: s3cr3t
            ```
        3. μ•”νΈν™”λ  λ°μ΄ν„°λ¥Ό κ°–λ” POST μ”μ²­μ„ /encrypt μ—”λ“ν¬μΈνΈμ— ν•κΈ° (κµ¬μ„± μ„λ²„κ°€ /encrypt μ—”λ“ν¬μΈνΈ μ κ³µ)
            * ex) λ½κ³ DBμ λΉ„λ°€λ²νΈ("s3cr3tP455w0rd")λ¥Ό μ•”νΈν™”
            ```
            $ curl localhost:8888/encrypt -d "s3cr3tP455w0rd"
            e9d90d9...
            ```
            * μ•”νΈν™”λ κ°’μ„ λ³µμ‚¬ν•μ—¬ Git λ¦¬ν¬μ§€ν† λ¦¬μ— μ €μ¥λ κµ¬μ„± νμΌμ— λ¶™μ—¬λ„£κΈ°
            ```yml
            spring:
                data:
                    mongodb:
                        password: '{ciper}e9d90d9...' # '{ciper}μ•”νΈν™”κ°’' : ν•΄λ‹Ή κ°’μ΄ μ•”νΈν™”λ κ°’μ΄λΌλ” κ²ƒμ„ μ•λ ¤μ£Όλ” κ²ƒ
            ```
        4. μ„μ μ‘μ—…λ“¤μ„  κµ¬μ„± μ„λ²„μ Git λ¦¬ν¬μ§€ν† λ¦¬μ— commit ν›„ push : μ•”νΈν™”λ μ†μ„±λ“¤μ„ κµ¬μ„± μ„λ²„κ°€ μ κ³µν•  μ¤€λΉ„ μ™„λ£
        5. κµ¬μ„± μ„λ²„μ ν΄λΌμ΄μ–ΈνΈλ΅ curlμ„ μ‚¬μ©ν•΄μ„ μ‹¤μ λ΅ μ λλ”μ§€ ν™•μΈν•κΈ°
            ```
            $ curl localhost:8888/application/default | jq
            {
                "name": "app",
                "profiles": [
                    "prof"
                ],
                "label": null,
                "version": "asfr",
                "state": null,
                "propertySources": [
                    {
                        "name": "http://localhost:10080/tacocloud/tacocloudconfig/application.yml",
                        "source": {
                            "spring.data.mongodb.password": "s3cr3tP455w0rd"
                        }
                    }
                ]
            }
            ```
            * mongodb.passwordλ¥Ό λ³µνΈν™”λ ν•νƒλ΅ μ κ³µν•¨
            * κµ¬μ„± μ„λ²„κ°€ μ κ³µν•λ” μ•”νΈν™”λ κ°’μ€ λ°±μ—”λ“ Git λ¦¬ν¬μ§€ν† λ¦¬μ— μ €μ¥λμ–΄μμ„ λ•λ§ μ•”νΈν™”λμ–΄ μμΌλ©°, κµ¬μ„± μ„λ²„μ— μν•΄ λ³µνΈν™”λ ν›„μ— μ κ³µλλ‹¤.
            => λ”°λΌμ„, ν•΄λ‹Ή κµ¬μ„±μ„ μ‚¬μ©ν•λ” ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ€ Gitλ¦¬ν¬μ§€ν„°λ¦¬μ μ•”νΈν™”λ μ†μ„±λ“¤μ„ λ°›κΈ° μ„ν•΄ μ–΄λ–¤ νΉλ³„ν• μ½”λ“λ” κµ¬μ„±λ„ κ°€μ§ ν•„μ” X
            * λ§μ•½ κµ¬μ„± μ„λ²„κ°€ μ•”νΈν™”λ μ†μ„±μ κ°’μ„ μλ” κ·Έλ€λ΅(λ³µνΈν™”ν•μ§€ μ•κ³ ) μ κ³µν•κΈ° μ›ν•λ‹¤λ©΄ <code>spring.cloud.config.server.encrypt.enabled : false</code>λ΅ μ„¤μ •
                ```yml
                spring:
                    cloud:
                        config:
                            server:
                                git:
                                    uri: http://localhost:10080/tacocloud/tacocloud-config
                                encrypt:
                                    enabled: false # μ΄ κ²½μ°μ κµ¬μ„± μ„λ²„λ” μ•”νΈν™”λ μ†μ„± κ°’μ„ λΉ„λ΅―ν•΄ λ¨λ“  μ†μ„± κ°’μ„ Git λ¦¬ν¬μ§€ν„°λ¦¬μ— μ„¤μ •λ κ·Έλ€λ΅ μ κ³µν•¨.
                ```
                * curlλ΅ λ‹¤μ‹ ν™•μΈ μ‹
                ```
                $ curl localhost:8888/application/default | jq
                {
                    ...
                    "propertySources": [
                        {
                            "name": "http://localhost:10080/tacocloud/tacocloudconfig/application.yml",
                            "source": {
                                "spring.data.mongodb.password": "{cipher}sa34ra3wa..."
                            }
                        }
                    ]
                }
                ```
                * μ΄λ•λ” μ•”νΈν™”λ μ†μ„± κ°’μ„ λ°›μΌλ―€λ΅ ν΄λΌμ΄μ–ΈνΈκ°€ λ³µνΈν™”ν•΄μ•Ό ν•¨.

* μ„μ™€ κ°™μ΄, μ•”νΈν™”λ μ†μ„± κ°’μ„ κµ¬μ„± μ„λ²„κ°€ μ κ³µν•λ„λ΅ Git λ¦¬ν¬μ§€ν„°λ¦¬μ— μ €μ¥ν•  μ μμ.
* ν•μ§€λ§ μ•”νΈν™”λ” Git λ¦¬ν¬μ§€ν„°λ¦¬μ λ³Έλ κΈ°λ¥μ΄ μ•„λ‹λΌ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•΄μ„ μ €μ¥ν•λ ¤λ©΄ λ³„λ„μ λ…Έλ ¥μ΄ ν•„μ”ν•¨. + λ³΄μ•μ΄ ν•„μ”ν• μ†μ„±μ€ λ„κ°€ μ”μ²­ν•λ“  κµ¬μ„± μ„λ²„ APIλ¥Ό ν†µν•΄ λ³µνΈν™”λμ–΄ μ κ³µν•¨.


##### Vaultμ— λ³΄μ• μ†μ„± μ €μ¥ν•κΈ°
* ν•΄μ‹μ½”ν”„μ Vault : λ³΄μ• κ΄€λ¦¬ λ„κµ¬ - Vaultκ°€ λ³΄μ• μ •λ³΄λ¥Ό μμ²΄μ μΌλ΅ μ²λ¦¬ν•¨
    * λ³΄μ•μ— λ―Όκ°ν• κµ¬μ„± λ°μ΄ν„°μ κ²½μ° : Vault > Git
* Vault μ‹μ‘&μ μ© λ°©λ²• μ°Έκ³  : https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-install

<br><br>
---

### μ‹¤μ‹κ°„μΌλ΅ κµ¬μ„± μ†μ„± λ¦¬ν”„λ μ‹ ν•κΈ°
* μ¤ν”„λ§ ν΄λΌμ°λ“ κµ¬μ„± μ„λ²„λ” μ‹¤ν–‰ μ¤‘μΈ μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ¤‘λ‹¨μ‹ν‚¤μ§€ μ•κ³  μ‹¤μ‹κ°„μΌλ΅ κµ¬μ„± μ†μ„±μ„ λ¦¬ν”„λ μ‹ ν•  μ μλ‹¤.
* μ¦‰, λ°±μ—”λ“ Git λ¦¬ν¬μ§€ν„°λ¦¬λ‚ Vault λ³΄μ• μ„λ²„μ— λ³€κ²½ λ°μ΄ν„°κ°€ ν‘Έμ‹λλ©΄ μ• ν”λ¦¬μΌ€μ΄μ…μ κ° λ§μ΄ν¬λ΅μ„λΉ„μ¤λ” μƒλ΅μ΄ κµ¬μ„±μΌλ΅ μ¦‰μ‹ λ¦¬ν”„λ μ‹λλ‹¤.
* λ¦¬ν”„λ μ‹ λ°©λ²•
    * μλ™μ‹ : κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈλ” <code>/actuator/refresh</code>μ νΉλ³„ν• μ•΅μ¶”μ—μ΄ν„° μ—”λ“ν¬μΈνΈ ν™μ„±ν™”ν•¨. κ·Έλ¦¬κ³  κ° μ„λΉ„μ¤μ—μ„ μ΄ μ—”νΈν¬μΈνΈλ΅ HTTP POST μ”μ²­ μ‹ κµ¬μ„± ν΄λΌμ΄μ–ΈνΈκ°€ κ°€μ¥ μµκ·Όμ κµ¬μ„±μ„ λ°±μ—”λ“λ΅λ¶€ν„° κ°€μ Έμ΄.
        * μ¥μ  : μ„λΉ„μ¤κ°€ λ¦¬ν”„λ μ‹λλ” κµ¬μ„±μΌλ΅ μ—…λ°μ΄νΈ μ‹μ μ„ λ” μ •ν™•ν•κ² μ μ–΄ν•  μ μμ.
        * λ‹¨μ  : λ§μ΄ν¬λ΅ μ„λΉ„μ¤μ μΈμ¤ν„΄μ¤μ— λ€ν•΄ κ°λ³„μ μΈ HTTP μ”μ²­μ΄ μν–‰λμ–΄μ•Ό ν•¨.
    * μλ™μ‹ : λ¦¬ν¬μ§€ν„°λ¦¬μ μ»¤λ°‹ ν›„ν¬(commit hook)κ°€ λ¨λ“  μ„λΉ„μ¤μ λ¦¬ν”„λ μ‹λ¥Ό μ΄‰λ°ν•  μ μμ. μ΄ λ•, κµ¬μ„± μ„λ²„μ™€ μ΄κ²ƒμ ν΄λΌμ΄μ–ΈνΈ κ°„μ ν†µμ‹ μ„ μ„ν•΄ μ¤ν”„λ§ ν΄λΌμ°λ“ λ²„μ¤(spring cloud bus)λΌλ” μ¤ν”„λ§ ν΄λΌμ°λ“ ν”„λ΅μ νΈκ°€ κ°μ…ν•¨.
        * μ¥μ  : μ• ν”λ¦¬μΌ€μ΄μ…μ λ¨λ“  λ§μ΄ν¬λ΅μ„λΉ„μ¤μ— λ€ν•΄ μ¦‰μ‹λ΅ λ³€κ²½ κµ¬μ„±μ„ μ μ©ν•¨.
        * λ‹¨μ  : κµ¬μ„± λ¦¬νΌμ§€ν„°λ¦¬μ— μ»¤λ°‹μ„ ν•  λ• μν–‰λλ―€λ΅ ν”„λ΅μ νΈμ— λ”°λΌμ„λ” ν° λ¶€λ‹΄μ΄ λ¨.

##### κµ¬μ„± μ†μ„±μ„ μλ™μΌλ΅ λ¦¬ν”„λ μ‹ν•κΈ°
* μ¤ν”„λ§ λ¶€νΈ μ•΅μ¶”μ—μ΄ν„° : λ°νƒ€μ„ νμ•… λ° λ΅κΉ… μμ¤€κ³Ό κ°™μ€ λ°νƒ€μ„ μƒνƒμ μΌλ¶€ μ ν•μ μΈ μ μ–΄λ¥Ό κ°€λ¥ν•κ² ν•¨.
    * μ¤ν”„λ§ ν΄λΌμ°λ“ κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈλ΅ κµ¬μ„±λ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„λ§ μ‚¬μ©ν•  μ μλ” μ•΅μ¶”μ—μ΄ν„°μ νΉμ • κΈ°λ¥μ„ μ•μ•„λ³Ό κ²ƒμ΄λ‹¤

1. μμ΅΄μ„± μ¶”κ°€
    ```gradle
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    ```
    * κµ¬μ„± μ„λ²„μ ν΄λΌμ΄μ–ΈνΈλ΅ μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν™μ„±ν™”ν•λ©΄, κµ¬μ„± μ†μ„±λ“¤μ„ λ¦¬ν”„λ μ‹ν•κΈ° μ„ν•΄ μλ™-κµ¬μ„±μ΄ μ•΅μ¶”μ—μ΄ν„° μ—”λ“ν¬μΈνΈλ¥Ό κµ¬μ„±ν•¨.
    * μ‹¤ν–‰ μ¤‘μΈ κµ¬μ„± ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ— μ•΅μ¶”μ—μ΄ν„°κ°€ ν™μ„±ν™”λλ―€λ΅, <code>/actuator</code> refreshμ— λ€ν• HTTP POST μ”μ²­μ„ μ μ¶ν•μ—¬ μ–Έμ λ“  μ°λ¦¬κ°€ μ›ν•  λ• λ°±μ—”λ“ λ¦¬νΌμ§€ν„°λ¦¬λ΅λ¶€ν„° κµ¬μ„± μ†μ„±μ„ λ¦¬ν”„λ μ‹ ν•  μ μλ‹¤.

2. urlμ„ ν†µν• λ¦¬ν”„λ μ‹
    * ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…
        ```java
        // controller
        @RestController
        public class GreetingController {
        
            private final GreetingProps props;

            public GreetingController(GreetingProps props) {
                this.props = props;
            }

            @GetMapping("/hello")
            public String message() {
                return props.getMessage();
            }
        
        }

        // GreetingProps
        @ConfigurationProperties(prefix = "greeting") // application.ymlμ—μ„ greetingμΌλ΅ λμ–΄μλ” ν•­λ© κ°€μ Έμ¤κΈ°
        @Component
        public class GreetingProps {
            private String message;

            public String getMessage() {
                return message;
            }

            public void setMessage(String message) {
                this.message = message;
            }
        }
        ```
    * κµ¬μ„± μ„λ²„μ application.yml
        ```yml
        greeting:
            message: Hello World!
        ```
    * ν…μ¤νΈ : <code>/hello</code> api νΈμ¶
        ```
        $ curl localhost:8080/hello
        Hello World!
        ```

    1. κµ¬μ„± μ„λ²„μ application.yml μμ • ν›„ push
        ```yml
        greeting:
            message: Hiya folks!
        ```
        * ν…μ¤νΈ : <code>/hello</code> api νΈμ¶
            ```
            $ curl localhost:8080/hello
            Hello World!
            ```
            => ν΄λΌμ΄μ–ΈνΈ μ½μ—μ„λ” μ†μ„±μ΄ λ³€κ²½λ κ²ƒμ„ λ¨λ¥΄κΈ° λ•λ¬Έμ— κΈ°μ΅΄ κ·Έλ€λ΅ λ‚μ΄
    2. μ•΅μ¶”μ—μ΄ν„° λ¦¬ν”„λ μ‹ μ—”λ“ν¬μΈνΈλ΅ POST μ”μ²­
        ```
        $ curl localhost:8080/actuator/refresh -X POST
        ["config.client.version","greeting.message"]
        ```
        * ν…μ¤νΈ : <code>/hello</code> api νΈμ¶
            ```
            $ curl localhost:8080/hello
            Hiya folks!
            ```
            => ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ΄λ‚ κµ¬μ„± μ„λ²„λ¥Ό λ‹¤μ‹ μ‹μ‘μ‹ν‚¤μ§€ μ•κ³  μƒλ΅μ΄ κ°’μ„ μ κ³µν•¨.

* <code>/actuator/refresh</code> μ—”λ“ν¬μΈνΈμ μ¥μ  : κµ¬μ„± μ†μ„±μ΄ λ³€κ²½μ΄ μƒκΈ°λ” μ‹μ μ„ μ™„μ „ν•κ² μ μ–΄ν•κΈ° μ›ν• ν•  λ• μ•„μ£Ό μΆ‹μ.
* <code>/actuator/refresh</code> μ—”λ“ν¬μΈνΈμ λ‹¨μ  : ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ λ‹¤μμ λ§μ΄ν¬λ΅μ„λΉ„μ¤λ΅ κµ¬μ„±λλ‹¤λ©΄ κ·Έκ²ƒλ“¤ λ¨λ‘μ κµ¬μ„±μ„ λ¦¬ν”„λ μ‹ν•λ” κ²ƒμ„ λ§¤μ° λ²κ±°λ΅μ›€


##### κµ¬μ„± μ†μ„±μ„ μλ™μΌλ΅ λ¦¬ν”„λ μ‹ν•κΈ°
* κµ¬μ„± μ„λ²„λ” λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ—κ² μλ™μΌλ΅ κµ¬μ„± λ³€κ²½μ„ μ•λ ¤μ¤„ μ μλ‹¤.<br/>
    => <u>μ¤ν”„λ§ ν΄λΌμ°λ“ λ²„μ¤</u> μ‚¬μ©

* μλ™ λ¦¬ν”„λ μ‹ μ μ°¨
    ![alt text](image-4.png)<br/>
    1. μ›Ήν›…(webhook)μ΄ Git λ¦¬νΌμ§€ν„°λ¦¬μ— μƒμ„±λμ–΄ Git λ¦¬νΌμ§€ν„°λ¦¬μ— λ€ν• λ³€κ²½(ex.push)μ΄ μƒκ²Όμμ„ κµ¬μ„± μ„λ²„μ— μ•λ¦°λ‹¤.
        * webhook μ§€μ› : GitHub, GitLab, Bitbucket, Gogs ...
    2. κµ¬μ„± μ„λ²„λ” RabbitMQλ‚ μΉ΄ν”„μΉ΄(Kafka)μ™€ κ°™μ€ λ©”μ‹μ§€ λΈλ΅μ»¤λ¥Ό ν†µν•΄ λ³€κ²½ κ΄€λ ¨ λ©”μ‹μ§€λ¥Ό μ „νν•¨μΌλ΅μ¨ μ›Ήν›…μ POSTμ”μ²­μ— λ°μ‘ν•¨.
    3. μ•λ¦Ό(notifacation)μ„ κµ¬λ…ν•λ” κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ€ κµ¬μ„± μ„λ²„λ΅λ¶€ν„° λ°›μ€ μƒλ΅μ΄ μ†μ„± κ°’μΌλ΅ μμ‹ μ μ†μ„±μ„ λ¦¬ν”„λ μ‹ν•μ—¬ μ•λ¦Ό λ©”μ‹μ§€μ— λ°μ‘ν•¨.

* μλ™ λ¦¬ν”„λ μ‹ μ‹ κ³ λ ¤ν•  μ‚¬ν•­
    * κµ¬μ„± μ„λ²„μ™€ μ΄κ²ƒμ ν΄λΌμ΄μ–ΈνΈ κ°„μ λ©”μ‹μ§€ μ²λ¦¬μ— μ‚¬μ©ν•  μ μλ” λ©”μ‹μ§€ λΈλ΅μ»¤κ°€ μμ–΄μ•Όν•¨ (rabbitMQ λλ” Kafka)
    * κµ¬μ„± μ„λ²„μ— λ³€κ²½μ„ μ•λ ¤μ£ΌκΈ° μ„ν•΄ μ›Ήν›…μ΄ λ°±μ—”λ“ Git λ¦¬νΌμ§€ν„°λ¦¬μ— μƒμ„±λμ–΄μ•Όν•¨.
    * κµ¬μ„± μ„λ²„λ” κµ¬μ„± μ„λ²„ λ¨λ‹ν„° μμ΅΄μ„±(Git λ¦¬νΌμ§€ν„°λ¦¬λ΅λ¶€ν„°μ μ›Ήν›… μ”μ²­μ„ μ²λ¦¬ν•λ” μ—”λ“ν¬μΈνΈλ¥Ό μ κ³µ) λ° RabbitMQλ‚ μΉ΄ν”„μΉ΄ μ¤ν”„λ§ ν΄λΌμ°λ“ μ¤νΈλ¦Ό μμ΅΄μ„±(μ†μ„± λ³€κ²½ λ©”μ‹μ§€λ¥Ό λΈλ΅μ»¤μ—κ² μ „μ†΅ν•κΈ° μ„ν•¨)κ³Ό ν•¨κ» ν™μ„±ν™”λμ–΄μ•Όν•¨.
    * λ©”μ‹μ§€ λΈλ΅μ»¤κ°€ κΈ°λ³Έ μ„¤μ •μΌλ΅ λ΅μ»¬μ—μ„ μ‹¤ν–‰λλ” κ²ƒμ΄ μ•„λ‹λΌλ©΄, λΈλ΅μ»¤μ— μ—°κ²°ν•κΈ° μ„ν• μ„Έλ¶€ μ •λ³΄λ¥Ό κµ¬μ„± μ„λ²„μ™€ μ΄κ²ƒμ λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ— κµ¬μ„±ν•΄μ•Όν•¨.
    * κ° κµ¬μ„± μ„λ²„ <u>ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ— μ¤ν”„λ§ ν΄λΌμ°λ“ λ²„μ¤ μμ΅΄μ„±μ΄ μ¶”κ°€</u>λμ–΄μ•Όν•¨

* μ μ© λ°©λ²•
    1. MQ μ‹¤ν–‰μ¤‘ + μ†μ„± λ³€κ²½ λ©”μ‹μ§€ μ „λ‹¬ μ¤€λΉ„ μ™„λ£
    2. μ›Ήν›… μƒμ„±
        * κµ¬μ„± μ„λ²„μ git repository -> setting -> 'Webhooks' -> 'add webhook'
            ![alt text](image-5.png)
        * URL : <code>/monitor</code>, content-type : <code>application/json</code> 
            ![alt text](image-6.png)<br/>
            * κµ¬μ„± λ¦¬νΌμ§€ν„°λ¦¬μ— λ€ν• ν‘Έμ‹ μ”μ²­μ—λ§ μ›Ήν›…μ΄ μ‘λ™ν•λ„λ΅ "Just the Push Event" λ²„νΌ ν΄λ¦­ + μ›Ήν›…μ„ ν™μ„±ν™”ν•κΈ° μ„ν• Active μ²΄ν¬λ°•μ¤ μ„ νƒ
            * λ³΄μ• ν•„λ“μ κ°’ μ„¤μ • μ‹ μ›Ήν›… POST μ”μ²­μ— <code>X-Hub-Signature</code>λΌλ” ν—¤λ”κ°€ ν¬ν•¨λ¨.
            * <b>κ²°κ³Ό</b> : <u>μ΄ν›„λ΅ λ¦¬νΌμ§€ν„°λ¦¬μ— ν‘Έμ‹κ°€ λ°μƒν•  λ•λ§λ‹¤ κµ¬μ„± μ„λ²„μ— POST μ”μ²­μ„ μ „μ†΅ν•¨.</u> <u>(ν•„μ! : μ΄λ° μ”μ²­μ„ μ²λ¦¬ν•κΈ° μ„ν•΄ κµ¬μ„± μ„λ²„μ /monitor μ—”λ“ν¬μΈνΈλ¥Ό ν™μ„±ν™”ν•κΈ°)</u>
    3. κµ¬μ„± μ„λ²„μ—μ„ μ›Ήν›… μ²λ¦¬ν•κΈ° => <u>κµ¬μ„± μ„λ²„μ /monitor μ—”λ“ν¬μΈνΈ ν™μ„±ν™” ν•κΈ°</u>
        * κµ¬μ„± μ„λ²„μ—μ„
        1. μμ΅΄μ„± μ¶”κ°€
            ```gradle
            // μλ™μΌλ΅ <code>/monitor</code> μ—”λ“ν¬μΈνΈ ν™μ„±ν™”
            implementation 'org.springframework.cloud:spring-cloud-config-monitor' 

            // λ³€κ²½ μ•λ¦Όμ„ μ „νν•λ” μλ‹¨ - rabbitMQ
            implementation 'org.springframework.cloud:spring-cloud-starter-stream-rabbit' 

            // λ³€κ²½ μ•λ¦Όμ„ μ „νν•λ” μλ‹¨ - kafka
            implementation 'org.springframework.cloud:spring-cloud-starter-stream-kafka' 
            ```
            * μ¤ν”„λ§ ν΄λΌμ°λ“ μ¤νΈλ¦Ό : RabbitMQ λλ” Kafkaλ¥Ό ν†µν•΄ ν†µμ‹ ν•λ” μ„λΉ„μ¤λ“¤μ„ μƒμ„±ν•  μ μμ. => μ΄ μ„λΉ„μ¤λ“¤μ€ μ¤νΈλ¦ΌμΌλ΅λ¶€ν„° μ²λ¦¬ν•  λ°μ΄ν„°λ¥Ό λ°›μΌλ©°, ν•μ„ μ¤νΈλ¦Ό μ„λΉ„μ¤κ°€ μ²λ¦¬ν•λ„λ΅ μ¤νΈλ¦ΌμΌλ΅ λ°μ΄ν„°λ¥Ό λ°ν™ν•¨.
            * /monitor μ—”λ“ν¬μΈνΈλ” μ¤ν”„λ§ ν΄λΌμ°λ“ μ¤νΈλ¦Όμ„ μ‚¬μ©ν•΄μ„ κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈμ— μ•λ¦Ό λ©”μ„Έμ§€λ¥Ό μ „μ†΅ν•λ‹¤.
        2. application.yml μ„¤μ •
            ```yml
            # rabbitMQ μ‚¬μ© μ‹
            spring:
                rabbitmq:
                    host: rabbit.tacocloud.com
                    port: 5672
                    username: tacocloud
                    password: s3cr3t

            # kafka μ‚¬μ© μ‹
            spring:
                kafka:
                    bootstrap-servers:
                    - kafka.tacocloud.com:9092
                    - kafka.tacocloud.com:9093
                    - kafka.tacocloud.com:9094
            ```
    4. Gogs μ•λ¦Ό μ¶”μ¶κΈ° μƒμ„±ν•κΈ°
        * μ›Ήν›…μ POST μ”μ²­μ„ μ²λ¦¬ν•  λ• μ„λ΅ λ‹¤λ¥Έ λ°μ΄ν„° ν•μ‹μ„ <code>/monitor</code>μ—”λ“ν¬μΈνΈκ°€ μ• μ μμ–΄μ•Ό ν•¨.
        * <code>/monitor</code> μ—”λ“ν¬μΈνΈ λ‚΄λ¶€ : POST μ”μ²­μ„ μ΅°μ‚¬ν•κ³ , μ–΄λ–¤ μΆ…λ¥μ Git μ„λ²„λ΅λ¶€ν„° μ¨ μ”μ²­μΈμ§€ νλ‹¨ν• ν›„, κ° ν΄λΌμ΄μ–ΈνΈμ— μ „μ†΅λ  μ•λ¦Ό νƒ€μ…μΌλ΅ μ”μ²­ λ°μ΄ν„°λ¥Ό λ³€ν™ν•¨.
    5. κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈμ— μ†μ„±μ μλ™ λ¦¬ν”„λ μ‹ ν™μ„±ν™”ν•κΈ°
        * ν΄λΌμ΄μ–ΈνΈμ—μ„
        * μμ΅΄μ„± μ¶”κ°€
            ```gradle
            // AMQP(ex.RabbitMQ) μ¤ν”„λ§ ν΄λΌμ°λ“ λ²„μ¤ μ¤νƒ€ν„°λ¥Ό λΉλ“μ— μ¶”κ°€ν•¨.
            implementation 'org.springframework.cloud:spring-cloud-starter-bus-amqp'

            // μΉ΄ν”„μΉ΄ μ‚¬μ© μ‹
            implementation 'org.springframework.cloud:spring-cloud-starter-bus-kafka'
            ```
        * μ ν•©ν• μ¤ν”„λ§ ν΄λΌμ°λ“ λ²„μ¤ μ¤νƒ€ν„° μ¶”κ°€ μ‹, λ΅μ»¬μ—μ„ μ‹¤ν–‰λλ” RabbitMQ λΈλ΅μ»¤λ‚ μΉ΄ν”„μΉ΄ ν΄λ¬μ¤ν„°μ— μλ™μΌλ΅ λ°”μΈλ”© λ¨.
        * λ§μ•½ RabbitMQλ‚ μΉ΄ν”„μΉ΄κ°€ λ΅μ»¬μ΄ μ•„λ‹ λ‹¤λ¥Έ κ³³μ—μ„ μ‹¤ν–‰ μ¤‘μ΄λΌλ©΄ κµ¬μ„± μ„λ²„ μμ²΄μ— ν–λ κ²ƒμ²λΌ κ° ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ— κ·Έκ²ƒμ— κ΄€ν• μ •λ³΄λ¥Ό κµ¬μ„±ν•΄μ•Ό ν•¨.
    6. κµ¬μ„± μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ λ¨λ‘ μλ™ λ¦¬ν”„λ μ‹λλ„λ΅ κµ¬μ„±ν•¨
        * test - κµ¬μ„± μ„λ²„μ application.yml μ†μ„±μ„ λ³€κ²½ ν›„ push μ‹ κ·Έ μ¦‰μ‹ ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ— λ³€κ²½μ΄ μ μ©λ¨.


## μ”μ•½
* μ¤ν”„λ§ ν΄λΌμ°λ“ κµ¬μ„± μ„λ²„λ” μ¤‘μ•™ μ§‘μ¤‘ν™”λ <u>κµ¬μ„± λ°μ΄ν„° μ†μ¤</u>λ¥Ό λ§μ΄ν¬λ΅μ„λΉ„μ¤ κΈ°λ°μ λ” ν° μ• ν”λ¦¬μΌ€μ΄μ…μ„ κµ¬μ„±ν•λ” <u>λ¨λ“  λ§μ΄ν¬λ΅ μ„λΉ„μ¤μ— μ κ³µ</u>ν•¨.
* κµ¬μ„± μ„λ²„κ°€ μ κ³µν•λ” μ†μ„±λ“¤μ€ λ°±μ—”λ“ Gitμ΄λ‚ Vault λ¦¬νΌμ§€ν„°λ¦¬μ—μ„ μ μ§€&κ΄€λ¦¬ λ¨.
* λ¨λ“  κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈμ— μ κ³µλλ” <u>μ „μ—­μ μΈ μ†μ„±λ“¤</u>μ— μ¶”κ°€ν•μ—¬ κµ¬μ„± μ„λ²„λ” ν”„λ΅νμΌμ— <u>νΉμ •λ μ†μ„±</u>κ³Ό μ• ν”λ¦¬μΌ€μ΄μ…μ— νΉμ •λ μ†μ„±λ„ μ κ³µν•  μ μμ.
* λ³΄μ•μ— λ―Όκ°ν• μ†μ„±λ“¤μ€ λ°±μ—”λ“ Git λ¦¬νΌμ§€ν„°λ¦¬μ— μ•”νΈν™”ν•μ—¬ μ €μ¥ν•κ±°λ‚ Vault λ°±μ—”λ“μ λ³΄μ• μ†μ„±μΌλ΅ μ €μ¥ν•μ—¬ λ³΄μ•μ„ μ μ§€ν•  μ μμ.
* κµ¬μ„± μ„λ²„ ν΄λΌμ΄μ–ΈνΈλ” μƒλ΅μ΄ μ†μ„±μΌλ΅ λ¦¬ν”„λ μ‹ ν•  μ μμ.
    * μλ™μΌλ΅ λ¦¬ν”„λ μ‹ : μ•΅μ¶”μ—μ΄ν„° μ—”λ“ν¬μΈνΈλ¥Ό ν†µν•΄ μλ™μΌλ΅ λ¦¬ν”„λ μ‹ κ°€λ¥
    * μλ™μΌλ΅ λ¦¬ν”„λ μ‹ : μ¤ν”„λ§ ν΄λΌμ°λ“ λ²„μ¤μ™€ Git μ›Ήν›…μ„ μ‚¬μ©ν•΄μ„ μλ™μΌλ΅ λ¦¬ν”„λ μ‹ κ°€λ¥
* μµλ€ μ¥μ  : Spring Cloud Config μ„ μ‚¬μ©ν•λ©΄ μ‚¬μ©μκ°€ μ™Έλ¶€ μ„¤μ • μ €μ¥μ†μ μ„¤μ • μ •λ³΄λ¥Ό μµμ‹ ν™” ν–μ„ λ•, Config Serverμ„ λ‹¤μ‹ λΉλ“ λ° λ°°ν¬ν•  ν•„μ”κ°€ μ—†λ‹¤ π”¥


#### μ°Έμ΅°
* μ¶”κ°€ μ„¤λ… : https://velog.io/@choidongkuen/Spring-Cloud-Spring-Cloud-Config-%EC%97%90-%EB%8C%80%ED%95%B4
* μ„¤μ • λ°©λ²• : https://medium.com/@boskyjoseph/spring-cloud-config-with-spring-boot-3-a94bb4a48fd